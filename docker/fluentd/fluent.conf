<source>
  @type tail
  @id suricata_logs
  tag suricata.logs
  path /var/log/suricata/eve.json
  pos_file /fluentd/log/suricata.pos
  read_from_head true
  <parse>
    @type json
  </parse>
</source>

<filter suricata.logs>
  @type record_transformer
  @id transform_suricata_logs
  enable_ruby true
  <record>
    timestamp ${time.strftime('%Y-%m-%dT%H:%M:%S%z')}
    src_ip ${record["src_ip"]}
    dest_ip ${record["dest_ip"]}
    action ${record["action"]}
    event_type ${record["event_type"]}
    log_data_jsonb ${Yajl.dump(record)}
  </record>
</filter>

<match suricata.logs>
  @type http
  @id http_output
  endpoint_url http://axum:3000
  http_method post
  <format>
    @type json
  </format>
  <buffer>
    @type memory
    flush_interval 5s
    flush_at_shutdown true
    chunk_limit_size 4m
    retry_forever true
    retry_wait 10s
  </buffer>
</match>
