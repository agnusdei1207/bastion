version: "3.8"

services:
  suricata:
    container_name: suricata
    image: agnusdei1207/suricata:latest
    cap_add:
      - SYS_NICE # ë‚®ì€ ìš°ì„ ìˆœìœ„ í”„ë¡œì„¸ìŠ¤ í—ˆìš©
      - NET_ADMIN # ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì œì–´ í—ˆìš©
    volumes:
      - suricata-log:/var/log/suricata # Suricata ë¡œê·¸ ì €ì¥
      - suricata-config:/etc/suricata:rw # ì„¤ì • ë° ë£° ê³µìœ 
    command:
      - "-c"
      - "/etc/suricata/suricata.yaml"
      - "-i"
      - "eth0"
      - "--af-packet"
      - "--runmode=autofp"
      - "--set=af-packet.0.copy-mode=ips"
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "1"
    networks:
      - tct-network

  fluentd:
    container_name: fluentd
    image: agnusdei1207/fluentd:latest
    volumes:
      - suricata-log:/var/log/suricata:rw # Suricata ë¡œê·¸ ì½ê¸°
      - fluentd-volume:/fluentd/state # Fluentd ë‚´ë¶€ ìƒíƒœ ì €ì¥
    depends_on:
      - suricata
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "1"
    networks:
      - tct-network

  axum:
    container_name: axum
    image: agnusdei1207/axum:latest
    volumes:
      - axum-volume:/app/logs # Axum ìì²´ ë¡œê·¸ ì €ì¥
      - suricata-log:/shared/suricata:rw # Suricata ë¡œê·¸ ì ‘ê·¼
      - suricata-config:/shared/suricata-config:rw # ì„¤ì • ë° ë£° ì ‘ê·¼ (Axum ì „ìš© ê²½ë¡œ)
      - fluentd-volume:/shared/fluentd:rw # Fluentd ìƒíƒœ ì ‘ê·¼
    depends_on:
      - fluentd
    restart: unless-stopped
    ports:
      - "3000:3000"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "1"
    networks:
      - tct-network

volumes:
  suricata-log: # Suricata ë¡œê·¸ ì €ì¥
    driver: local
  suricata-config: # Suricata ì„¤ì • ë° ë£° ê³µìœ 
    driver: local
  fluentd-volume: # Fluentd ìƒíƒœ ì €ì¥
    driver: local
  axum-volume: # Axum ë¡œê·¸ ì €ì¥
    driver: local

# ğŸŒ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì •ì˜
networks:
  tct-network:
    driver: bridge
